<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Converting TCL to FSX </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Converting TCL to FSX ">
    <meta name="generator" content="docfx 2.56.6.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="converting-tcl-to-fsx">Converting TCL to FSX</h1>

<p>This article shows how a sample TCL script can be converted to an F# version.</p>
<p>If you follow this article you will see some examples of how to use the provided API functions.</p>
<p>The full sample scipts can be found here:</p>
<ul>
<li>TCL script <a href="https://github.com/pbbwfc/ScincNet/blob/main/scripts/importWhite.tcl">ImportWhite.tcl</a></li>
<li>F# script <a href="https://github.com/pbbwfc/ScincNet/blob/main/scripts/importWhite.fsx">ImportWhite.fsx</a></li>
</ul>
<h2 id="usage">Usage</h2>
<p>For the TCL script it needs to be run using the SCID interpreter: <strong>tcscid.exe</strong>.</p>
<p>If you navigate to the location of the script then you can run it in a command prompt using:</p>
<pre><code>&quot;D:\Scid vs PC-4.21\bin\tcscid&quot; ImportWhite.tcl
</code></pre>
<p>For the F# script, this is built to depend on .NET Core. You therefore need to use F# interactive for this rather tha the .NET Standard version. The easiest way to do this is to use Visual Studio Code with the Ionide Extension.</p>
<p>You can also run it on the command line, like TCL, but using:</p>
<pre><code>dotnet fsi ImportWhite.fsx
</code></pre>
<p>To use the .NET version of the API in the F# script you need to reference <strong>ScincFuncs.dll</strong> and open the namespace <strong>ScincFuncs</strong> at the start of the script. We are also going to use file operations and so also need to open <strong>System.IO</strong>. Thus we use:</p>
<pre><code class="lang-fsharp">#r @&quot;D:\GitHub\ScincNet\debug\bin\ScincFuncs.dll&quot;
open ScincFuncs
open System.IO
</code></pre>
<h2 id="step-1---create-the-database">Step 1 - Create the Database</h2>
<p>In TCL, we first create the database. We then open the database and print an error message if this fails. We then check that it is not read only. We then get the number of games in the database (which should be 0) and then print a message to the console.</p>
<p>This is the code:</p>
<pre><code class="lang-tcl">set basename D:/tmp/WhiteTCL
sc_base create $basename

if {[catch {sc_base open $basename} result]} {
    puts stderr &quot;Error opening database \&quot;$basename\&quot;: $result&quot;
    exit 1
}
if {[sc_base isReadOnly]} {
    puts stderr &quot;Error: database \&quot;$basename\&quot; is read-only.&quot;
    exit 1
}
set num [sc_base numGames] 

puts &quot;number of games: $num&quot;
</code></pre>
<p>This should produce this output:</p>
<pre><code class="lang-console">number of games: 0
</code></pre>
<p>The correspondong F# code is:</p>
<pre><code class="lang-fsharp">let basename = @&quot;D:/tmp/WhiteFSX&quot;
Base.Create(basename)|&gt;ignore

if (Base.Open(basename)&lt;0) then
    printfn &quot;Error opening database %s&quot; basename

if (Base.Isreadonly()) then
    printfn &quot;Error database %s is read only&quot; basename

let num = Base.NumGames()

printfn &quot;number of games: %i&quot; num
</code></pre>
<p>This produces this output:</p>
<pre><code class="lang-console">number of games: 0
</code></pre>
<h2 id="step-2---import-pgn-files">Step 2 - Import PGN files</h2>
<p>In TCL, we now create a set a folder that holds the PGN files. We then create a list of the pgn file names. We then loop through these names doing the following:</p>
<ul>
<li>create a full nam by including the folder</li>
<li>import the file</li>
<li>produce an error message if it fails</li>
<li>get the number of games imported</li>
<li>get the warnings generated</li>
<li>produce a message of the number of games imported</li>
<li>produce a message on the warnings
Finally close the database.</li>
</ul>
<p>This is the code:</p>
<pre><code class="lang-tcl">set fol &quot;D:/tmp/&quot;
set pgns [list &quot;Benko.pgn&quot; &quot;Benoni.pgn&quot; &quot;Budapest.pgn&quot; &quot;Dutch.pgn&quot; &quot;Grunfeld.pgn&quot; &quot;KingsIndian.pgn&quot; &quot;OldIndian.pgn&quot; &quot;QGA.pgn&quot; &quot;QGDmain.pgn&quot; &quot;QGDtarr.pgn&quot; &quot;QGDtri.pgn&quot; &quot;QGDunus.pgn&quot; &quot;Slav.pgn&quot;]
foreach pgn $pgns  {
    set pgnfile [file join $fol $pgn]

    if {[catch {sc_base import file $pgnfile} result]} {
        puts stderr &quot;Error importing \&quot;$pgnfile\&quot;: $result&quot;
        exit 1
    }
    set numImported [lindex $result 0]
    set warnings [lindex $result 1]
    puts &quot;Imported $numImported games from $pgnfile&quot;
    if {$warnings == &quot;&quot;} {
        puts &quot;There were no PGN errors or warnings.&quot;
    } else {
        puts &quot;PGN errors/warnings:&quot;
        puts $warnings
    }
}

sc_base close
</code></pre>
<p>This should produce this output:</p>
<pre><code class="lang-console">Imported 1 games from D:/tmp/Benko.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/Benoni.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/Budapest.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/Dutch.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/Grunfeld.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/KingsIndian.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/OldIndian.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/QGA.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/QGDmain.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/QGDtarr.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/QGDtri.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/QGDunus.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/Slav.pgn
There were no PGN errors or warnings.
</code></pre>
<p>The correspondong F# code is:</p>
<pre><code class="lang-fsharp">let fol = &quot;D:/tmp/&quot;
let pgns = [&quot;Benko.pgn&quot;; &quot;Benoni.pgn&quot;; &quot;Budapest.pgn&quot;; &quot;Dutch.pgn&quot;; &quot;Grunfeld.pgn&quot;; &quot;KingsIndian.pgn&quot;; &quot;OldIndian.pgn&quot;; &quot;QGA.pgn&quot;; &quot;QGDmain.pgn&quot;; &quot;QGDtarr.pgn&quot;; &quot;QGDtri.pgn&quot;; &quot;QGDunus.pgn&quot;; &quot;Slav.pgn&quot;]

let doimp pgn =
    let pgnfile = Path.Combine(fol,pgn)
    let mutable num = 0
    let mutable msgs = &quot;&quot;
    if (Base.Import(&amp;num,&amp;msgs,pgnfile)&lt;&gt;0) then
        printfn &quot;Error importing: %s&quot; pgnfile
    printfn &quot;Imported %i games from %s&quot; num pgnfile
    if msgs=&quot;&quot; then
        printfn &quot;There were no PGN errors or warnings.&quot;
    else
        printfn &quot;PGN errors/warnings:&quot;
        printfn &quot;%s&quot; msgs

pgns|&gt;List.iter doimp

Base.Close()|&gt;ignore
</code></pre>
<p>This produces this output:</p>
<pre><code class="lang-console">Imported 1 games from D:/tmp/Benko.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/Benoni.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/Budapest.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/Dutch.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/Grunfeld.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/KingsIndian.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/OldIndian.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/QGA.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/QGDmain.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/QGDtarr.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/QGDtri.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/QGDunus.pgn
There were no PGN errors or warnings.
Imported 1 games from D:/tmp/Slav.pgn
There were no PGN errors or warnings.
</code></pre>
<h2 id="step-3---classify-the-games">Step 3 - Classify the games</h2>
<p>In TCL, we now import a file of ECO codes. If this fails produce an error message. Now open the database again and check that it is not read only. Now classify the games generating messages. Finally, close the database.</p>
<p>This is the code:</p>
<pre><code class="lang-tcl">set ecofile &quot;D:/tmp/scid.eco&quot;
if {[catch {sc_eco read $ecofile} result]} {
    puts stderr &quot;Error reading ECO file: $result&quot;
    exit 1
}

# Open the database:
if {[catch {sc_base open $basename} result]} {
    puts stderr &quot;Error opening database \&quot;$basename\&quot;: $result&quot;
    exit 1
}
if {[sc_base isReadOnly]} {
    puts stderr &quot;Error: database \&quot;$basename\&quot; is read-only.&quot;
    exit 1
}

puts &quot;Classifying games...&quot;
puts [sc_eco base 1 1]
sc_base close
</code></pre>
<p>This should produce this output:</p>
<pre><code class="lang-console">Classifying games...
Classified 13 games in 0.00 seconds
</code></pre>
<p>The correspondong F# code is:</p>
<pre><code class="lang-fsharp">let ecofile = &quot;D:/tmp/scid.eco&quot;
if Eco.Read(ecofile)&lt;&gt;0 then
    printfn &quot;Error reading ECO file&quot;

if (Base.Open(basename)&lt;0) then
    printfn &quot;Error opening database %s&quot; basename

if (Base.Isreadonly()) then
    printfn &quot;Error database %s is read only&quot; basename

let mutable msgs = &quot;&quot;
Eco.Base(&amp;msgs)|&gt;ignore
printfn &quot;Classifying games...\n%s&quot; msgs

Base.Close()|&gt;ignore
</code></pre>
<p>This produces this output:</p>
<pre><code class="lang-console">Classifying games...
Classified 13 games in 0.00 seconds
</code></pre>
<h2 id="step-4---remove-comments-from-the-games">Step 4 - Remove comments from the games</h2>
<p>In TCL, we now open the database again and check that it is not read only. Now loop through each game removing the comments. Finally, close the database.</p>
<p>This is the code:</p>
<pre><code class="lang-tcl">if {[catch {sc_base open $basename} result]} {
    puts stderr &quot;Error opening database \&quot;$basename\&quot;: $result&quot;
    exit 1
}
if {[sc_base isReadOnly]} {
    puts stderr &quot;Error: database \&quot;$basename\&quot; is read-only.&quot;
    exit 1
}

for {set i 1} {$i &lt;= [sc_base numGames]} {incr i} {
    if {[catch { sc_game load $i }]} {
        puts &quot;Error: could not load game number $i&quot;
        exit 1
    }
    sc_game strip comments

    sc_game save $i
}
sc_base close
</code></pre>
<p>This produces no output.</p>
<p>The correspondong F# code is:</p>
<pre><code class="lang-fsharp">//TODO
</code></pre>
<h2 id="step-5---change-the-white-names-in-the-games-to-the-names-of-the-opening">Step 5 - Change the white names in the games to the names of the opening</h2>
<p>In TCL, we create a list of names to use. We now open the database again and check that it is not read only. Now loop through each game changing the white name and then saving it. Finally, close the database.</p>
<p>This is the code:</p>
<pre><code class="lang-tcl">set nms [list &quot;Benko&quot; &quot;Benoni&quot; &quot;Budapest&quot; &quot;Dutch&quot; &quot;Grunfeld&quot; &quot;Kings Indian&quot; &quot;Old Indian&quot; &quot;QGA&quot; &quot;QGD main&quot; &quot;QGD tarrasch&quot; &quot;QGD triangle&quot; &quot;QGD unusual&quot; &quot;Slav&quot;]

# Open the database:
if {[catch {sc_base open $basename} result]} {
    puts stderr &quot;Error opening database \&quot;$basename\&quot;: $result&quot;
    exit 1
}
if {[sc_base isReadOnly]} {
    puts stderr &quot;Error: database \&quot;$basename\&quot; is read-only.&quot;
    exit 1
}

for {set i 1} {$i &lt;= [sc_base numGames]} {incr i} {
    if {[catch { sc_game load $i }]} {
        puts &quot;Error: could not load game number $i&quot;
        exit 1
    }
    set nm [lindex $nms [expr $i-1]]
    sc_game tags set -white $nm

    sc_game save $i
}
sc_base close
</code></pre>
<p>This produces no output.</p>
<p>The correspondong F# code is:</p>
<pre><code class="lang-fsharp">//TODO
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/pbbwfc/ScincNet/blob/main/docfx_project/articles/tcl2fsx.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
